<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Tech Innovation Digest</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>

<header>
  <h1>Tech Innovation Digest</h1>
  <p>Veille automatique sur lâ€™innovation technologique</p>
  <a href="subscribe.html">ðŸ“© Sâ€™abonner Ã  la newsletter</a>
</header>

<main id="articles-list">
  Chargement des articlesâ€¦
</main>

<script>
const container = document.getElementById("articles-list");

const slugFromTitle = (article) => {
  if (article.file) return article.file;
  if (!article.title || !article.date) return "";

  const slug = article.title
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-+|-+$/g, "");

  return `${article.date}-${slug}.md`;
};

const formatDate = (value) => {
  const parsed = new Date(value);
  if (Number.isNaN(parsed.getTime())) return value || "Date inconnue";
  return parsed.toLocaleDateString("fr-FR");
};

fetch("assets/js/articles.json")
  .then((r) => r.json())
  .then((data) => {
    const articles = Array.isArray(data) ? data : (data && data.articles) || [];

    if (!articles.length) {
      container.innerHTML = "<p>Aucun article pour le moment.</p>";
      return;
    }

    container.innerHTML = articles
      .map((article) => {
        const file = slugFromTitle(article);
        const link = file
          ? `<a href="article.html?file=${encodeURIComponent(file)}">Lire lâ€™article â†’</a>`
          : "<em>Article non disponible</em>";

        return `
          <article class="article-card">
            <h2>${article.title || "Article"}</h2>
            <small>${formatDate(article.date)}</small>
            <br>
            ${link}
          </article>
        `;
      })
      .join("");
  })
  .catch(() => {
    container.innerText = "Erreur de chargement des articles.";
  });
</script>

</body>
</html>
